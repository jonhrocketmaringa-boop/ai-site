<!DOCTYPE html>
<html lang="ar">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>AI Chat</title>

<style>
body {
  margin: 0;
  font-family: Arial;
  background: #0b141a;
  color: white;
  display: flex;
  flex-direction: column;
  height: 100vh;
}

header {
  background: #202c33;
  padding: 15px;
  text-align: center;
  font-size: 18px;
}

#chat {
  flex: 1;
  overflow-y: auto;
  padding: 10px;
}

.msg {
  max-width: 70%;
  padding: 10px;
  margin: 5px;
  border-radius: 10px;
  line-height: 1.4;
}

.user {
  background: #005c4b;
  margin-left: auto;
}

.bot {
  background: #202c33;
  margin-right: auto;
}

footer {
  display: flex;
  padding: 10px;
  background: #202c33;
}

input {
  flex: 1;
  padding: 10px;
  border: none;
  border-radius: 20px;
  outline: none;
}

button {
  margin-left: 8px;
  padding: 10px 15px;
  border: none;
  border-radius: 20px;
  background: #00a884;
  color: white;
  cursor: pointer;
}
</style>
</head>

<body>

<header>ğŸ¤– Ù…Ø³Ø§Ø¹Ø¯Ùƒ Ø§Ù„Ø°ÙƒÙŠ</header>

<div id="chat"></div>

<footer>
  <input id="msg" placeholder="Ø§ÙƒØªØ¨ Ø±Ø³Ø§Ù„Ø©...">
  <button onclick="askAI()">Ø¥Ø±Ø³Ø§Ù„</button>
</footer>

<script>
const chatBox = document.getElementById("chat");

// ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù…Ø­Ø§Ø¯Ø«Ø© Ø§Ù„Ù‚Ø¯ÙŠÙ…Ø©
const saved = localStorage.getItem("chat");
if (saved) chatBox.innerHTML = saved;

function saveChat() {
  localStorage.setItem("chat", chatBox.innerHTML);
}

function addMessage(text, type) {
  const div = document.createElement("div");
  div.className = "msg " + type;
  div.innerText = text;
  chatBox.appendChild(div);
  div.scrollIntoView();
  saveChat();

  // ØµÙˆØª Ø§Ù„Ø±Ø¯
  if (type === "bot") {
    const speech = new SpeechSynthesisUtterance(text);
    speech.lang = "ar-SA";
    speechSynthesis.speak(speech);
  }
}

async function askAI() {
  const input = document.getElementById("msg");
  const text = input.value.trim();
  if (!text) return;

  addMessage(text, "user");
  input.value = "";

  addMessage("Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªÙÙƒÙŠØ±...", "bot");

  try {
    const res = await fetch(
      "https://api.allorigins.win/raw?url=https://api.affiliateplus.xyz/api/chatbot?message=" +
      encodeURIComponent(text)
    );

    const data = await res.json();
    const reply = data.message || "Ù…Ø§ÙƒÙˆ Ø±Ø¯ Ø­Ø§Ù„ÙŠØ§Ù‹";

    // ØªØ¹Ø¯ÙŠÙ„ Ø¢Ø®Ø± Ø±Ø³Ø§Ù„Ø© (Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªÙÙƒÙŠØ±)
    const bots = document.querySelectorAll(".bot");
    bots[bots.length - 1].innerText = reply;
    saveChat();

    // ØµÙˆØª
    const speech = new SpeechSynthesisUtterance(reply);
    speech.lang = "ar-SA";
    speechSynthesis.speak(speech);

  } catch {
    const bots = document.querySelectorAll(".bot");
    bots[bots.length - 1].innerText = "ØµØ§Ø± Ø®Ø·Ø£ Ø¨Ø§Ù„Ø§ØªØµØ§Ù„";
  }
}
</script>

</body>
</html>
